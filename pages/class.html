<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>分类</title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/reset.mui.css" />
		<link rel="stylesheet" type="text/css" href="../css/comm.css" />
		<style>
			.mui-row.mui-fullscreen>[class*="mui-col-"] {
				height: 84%;
			}
			
			.pro-title-list,
			.mui-control-content {
				overflow-y: auto;
				/*border-top: 1px solid #c8c7cc;*/
				height: 100%;
			}
			
			.mui-segmented-control .mui-control-item {
				line-height: 50px;
				width: 100%;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item,
			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item.mui-active {
				border: none;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				background-color: #FFFFFF;
				color: #50ad1d;
				border: none;
				margin-left: 1px;
				border-left: 4px solid #50ad1d !important;
			}
			
			.pro-content-list {
				border-left: 1px solid #c8c7cc;
				box-shadow: -1px 0px 4px #c8c7cc;
			}
			
			.class-top-pro,
			.class-bottom-pro {
				left: 0px;
				height: 8%;
				width: 100%;
				color: #666;
				background: #F5F5F5;
				border-top: 1px solid #c8c7cc;
				z-index: 11;
			}
			
			.class-top-pro {
				position: relative;
				top: 0px;
			}
			
			.class-bottom-pro {
				position: fixed;
				bottom: 0px;
				color: rgba(80, 173, 29, .8);
				font-size: 16px;
				background: #F5F5F5;
			}
			
			.pro-notice:before {
				content: '';
				display: inline-block;
				width: 50px;
				height: 30px;
				background-image: url(../images/notice.png);
				background-size: contain;
				background-repeat: no-repeat;
			}
			
			.pro-notice {
				height: 100%;
				overflow: hidden;
				white-space: nowrap;
			}
			/*重置图片大小*/
			
			.mui-table-view .mui-media-object {
				line-height: 56px;
				max-width: 56px;
				min-width: 56px;
				height: 56px;
				border-radius: 4px;
			}
			
			.mui-table-view-cell>a:not(.mui-btn) {
				margin: -16px -20px -20px;
			}
			/*重置列表的padding*/
			.mui-table-view-cell{
				padding: 10px 5px;
			}
			.mui-table-view .mui-media-object.mui-pull-left{
				margin-right: 4px;	
			}
			/*重置选择按钮的*/
			.mui-numbox{
			    width: 90px;
			    height: 35px;
			    padding: 0 30px;
			}
			.mui-numbox [class*=btn-numbox],
			.mui-numbox [class*=numbox-btn]
			{
				width: 30px;	
			}
			.pro-title-name{
				font-size:18px;
				font-weight: 500;
			}
			.pro-unit-number,
			.pro-less-number
			{
				font-size: 14px;
				color:#E23C26;
			}
			.mui-search .pro-search-input{
				margin: auto 6px;
			}
			.mui-search.mui-active:before {
				left: 8px;
				margin-top: -10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="header">
			<span class="mui-icon mui-pull-left"></span>
			<h1 class="mui-title">快速搭配</h1>
		</header>
		<div class="mui-content mui-fullscreen mui-row" id="muiContent">

			<div class="mui-row class-top-pro v-center">
				<div class="mui-col-xs-3 mui-text-center" id="classSearch">
					<span class="mui-icon mui-icon-search"></span>
					<span>搜索</span>
				</div>
				<div class="mui-col-xs-9" style="height:100%">
					<div class="pro-notice v-center">
						<div class="marquee v-center">
							<!--TODO 替换marquee标签-->
							<marquee behavior="scroll" direction="left">
								<div id="freeEat">
									15天免费恰巨型活动优惠开始了，点我了解详情。
								</div>
							</marquee>
						</div>
					</div>
				</div>
			</div>
			<div class="pro-title-list mui-col-xs-3">
				<div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
					<!--JS填充分类-->
				</div>
			</div>
			<div id="segmentedControlContents" class="pro-content-list mui-col-xs-9">
				<!--JS填充每个分类下的内容-->
			</div>
			<div class="class-bottom-pro v-center mui-row" id="proCartBar">
				<div class="mui-col-xs-8 mui-text-center">
					已选：
					<span id="totalChose">0</span>份
					&nbsp;&nbsp;&nbsp;&nbsp; 总计：¥ 
					<span id="totalPayMoney">0.0</span>元
				</div>
				<div class="mui-col-xs-4 mui-text-center">
					<button type="button" id="choseOver" class="mui-btn mui-btn-success yck-self-btn border-none">选好了</button>
				</div>
			</div>
			<!--这里的z-index要比遮罩层高-->
			<div class="class-bottom-pro v-center mui-row hide" style="z-index:99999;" id="serchContainer">
				<div class="mui-input-row mui-search mui-col-xs-9">
					<input type="search" class="mui-input-clear pro-search-input" id="proInputSearch" placeholder="请输入关键字搜索">
				</div>
				<div class="mui-col-xs-3 mui-text-center">
					<button type="button" class="mui-btn mui-btn-danger" id="searchBtn">搜索</button></div>
			</div>
		</div>
		<div class="mask-search-box hide" id="maskBox"></div>
		<script src="../js/mui.min.js"></script>
		<script src="../libs/lazyload/mui.lazyload.js" type="text/javascript" charset="utf-8"></script>
		<script src="../libs/lazyload/mui.lazyload.img.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/comm.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/until.js" type="text/javascript" charset="utf-8"></script>
		<script src="../mock/class.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var controls = document.getElementById("segmentedControls");
			var contents = document.getElementById("segmentedControlContents");
			// 选好了按钮
			var choseOver = document.getElementById("choseOver");
			// 左上角搜索
			var classSearch = document.getElementById("classSearch");
			// 底部搜索容器
			var serchContainer = document.getElementById("serchContainer");
			// 购物车价格数目容器
			var proCartBar = document.getElementById("proCartBar");
			// 搜索按钮
			var searchBtn = document.getElementById("searchBtn");
			// 搜索输入框
			var proInputSearch = document.getElementById("proInputSearch");
			// 纯粹的遮罩容器
			var maskBox = document.getElementById("maskBox");
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			//H5+能力在此处体现
			mui.plusReady(function() {
				// 设置沉浸式导航
				COM.biz.setImmersed();
				
				//去购物车的页面
				choseOver.addEventListener("tap",function(){
					//获得主页面的webview
				    var main = plus.webview.currentWebview().parent();
				    //触发主页面的gocart事件 
				    mui.fire(main,'gocart');
				})
			});
			// 初始化渲染页面
			initPage(classMock.list)
			
			// 初始化产品列表
			function initPage(data) {
				var titleArr = [];
				var contentArr = [];
				mui.each(data, function(i, item) {
					titleArr.push([
						'<a class="mui-control-item" href="#content' + i + '" data-id="', item.id, '">', item.title, '</a>'
					].join(""));
					//加载每个子项的内容
					contentArr.push([
						'<div id="content', i, '" class="mui-control-content"><ul class="mui-table-view">'
					].join(""));

					var tempArr = [];
					mui.each(item.childlist, function(j, o) {
						tempArr.push([
							'<li class="mui-table-view-cell mui-media">',
								'<img class="mui-media-object mui-pull-left lazy-load" data-src="',o.url,'" data-name="',o.name,'" ',j<8?["src=",o.url].join(""):["data-lazyload=",o.url].join(""),'>',
								'<div class="mui-media-body">',
									'<div class="mui-row pro-title-name"><div class="mui-col-sm-12">', o.name, '</div></div>',
									'<div class="mui-row  v-center">',
										'<div class="mui-col-sm-4">',
											'<div class="pro-unit-number">', o.unit, '</div>',
											'<div class="pro-less-number">还剩', o.less, '份</div>',
										'</div>',
										'<div class="mui-col-sm-8" style="margin:0 auto;">',
											'<div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="', o.less,'">',
												'<button class="mui-btn mui-numbox-btn-minus" type="button">-</button>',
												'<input class="mui-numbox-input font-14" type="number" readonly="readonly"/>',
												'<button class="mui-btn mui-numbox-btn-plus" type="button">+</button>',
											'</div>',
										'</div>',
									'</div>',
								'</div>',
							'</li>'
						].join(""))
					})
					contentArr.push(tempArr.join(""));
					contentArr.push('</ul></div>');
				});
				controls.innerHTML = titleArr.join("")
				contents.innerHTML = contentArr.join('');
				// 默认选中第一个
				controls.querySelector('.mui-control-item').classList.add('mui-active');
				contents.querySelector('.mui-control-content').classList.add('mui-active');
				// 设置图片懒加载
				mui('#segmentedControlContents').imageLazyload({
					placeholder:"../images/60x60.gif"
				});
			}
			// 创建搜索的文本
			function creatSearchContentHtml(data){
				var dest = [];
				try{
					var contentSearchId = document.getElementById("contentSearchId");
					contents.removeChild(contentSearchId);
				}catch(e){}
				if(!data.length){
					return COM.biz.noDataHtml();
				}
				dest.push([
					'<ul class="mui-table-view">'
				].join(""));
				mui.each(data,function(i,o){
					dest.push([
						'<li class="mui-table-view-cell mui-media">',
							'<img class="mui-media-object mui-pull-left lazy-load" src="',o.url,'" data-name="',o.name,'">',
							'<div class="mui-media-body">',
								'<div class="mui-row pro-title-name"><div class="mui-col-sm-12">', o.name, '</div></div>',
								'<div class="mui-row  v-center">',
									'<div class="mui-col-sm-4">',
										'<div class="pro-unit-number">', o.unit, '</div>',
										'<div class="pro-less-number">还剩', o.less, '份</div>',
									'</div>',
									'<div class="mui-col-sm-8" style="margin:0 auto;">',
										'<div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="', o.less,'">',
											'<button class="mui-btn mui-numbox-btn-minus" type="button" >-</button>',
											'<input class="mui-numbox-input font-14" type="number" readonly="readonly"/>',
											'<button class="mui-btn mui-numbox-btn-plus" type="button">+</button>',
										'</div>',
									'</div>',
								'</div>',
							'</div>',
						'</li>'
					].join(""))
				});
				dest.push('</ul>');
				
				var divDOM = document.createElement('div');
				divDOM.id = 'contentSearchId'; 
				divDOM.className = 'mui-control-content mui-active'; 
				divDOM.innerHTML = dest.join("");
				
				return divDOM
			}
			// 点击图片显示产品介绍
			mui("#segmentedControlContents").on("tap",".lazy-load",function(){
				var self = this;
				var imgSrc = self.getAttribute("src") ||self.getAttribute("data-src");
				var proTitle = self.getAttribute("data-name");
				COM.biz.creatProIntro({
					"url":imgSrc,
					"title":proTitle,
					"text": classDetail.products_intro
				})
			});
			// 跳转免费恰公告地址
			document.getElementById("freeEat").addEventListener("tap",function(){
				mui.openWindow({
					"url":"free-eat.html",
					"id":"free-eat.html"
				})
			});
			// 触发搜索框
			classSearch.addEventListener("tap",function(){
				// 隐藏购物状态
				proCartBar.classList.add("hide")
				// 显示搜索和遮罩
				serchContainer.classList.remove("hide");
				maskBox.classList.remove("hide");	
				// 根据ID 删除上次创建的列表
				proInputSearch.value = "";
			})
			// 点击确认搜索
			searchBtn.addEventListener("tap",function(){
				// 隐藏购物状态
				proCartBar.classList.remove("hide")
				// 显示搜索和遮罩
				serchContainer.classList.add("hide");
				maskBox.classList.add("hide");
				// 清空列表和内容的选择状态
				mui(".mui-control-item,.mui-control-content").each(function(i,o){
				  o.classList.remove("mui-active")
				});
				// 创建新的数据列表
				contents.appendChild(creatSearchContentHtml(searchMock))
			})
		</script>
	</body>

</html>